<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viva Sabor - Receitas Personalizadas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #7ba05b 0%, #d4a574 100%);
        }
        
        .gradient-accent {
            background: linear-gradient(135deg, #4a6b2a 0%, #b8941f 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-elegant {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(96, 128, 65, 0.1);
            box-shadow: 0 8px 32px rgba(96, 128, 65, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-elegant:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(96, 128, 65, 0.15);
            border-color: rgba(203, 139, 50, 0.3);
        }
        
        .recipe-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(203, 139, 50, 0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .recipe-card:hover::before {
            left: 100%;
        }
        
        .recipe-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 25px 50px rgba(96, 128, 65, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a6b2a 0%, #b8941f 100%);
            transition: left 0.3s ease;
            z-index: -1;
        }
        
        .btn-primary:hover::before {
            left: 0;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(96, 128, 65, 0.3);
        }
        
        .checkbox-custom {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid #608041;
            border-radius: 6px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .checkbox-custom:checked {
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            border-color: #cb8b32;
            transform: scale(1.1);
        }
        
        .checkbox-custom:checked::after {
            content: '✓';
            position: absolute;
            top: -1px;
            left: 3px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            stroke: #608041;
            stroke-linecap: round;
            transition: stroke-dasharray 0.6s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.8s ease-out;
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .border-gradient {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #608041, #cb8b32) border-box;
        }
        
        .recipe-step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .recipe-step::before {
            content: counter(step-counter);
            counter-increment: step-counter;
            position: absolute;
            left: 0;
            top: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(96, 128, 65, 0.3);
        }
        
        .recipe-instructions {
            counter-reset: step-counter;
        }
        
        .ingredient-item {
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .ingredient-item::before {
            content: '•';
            position: absolute;
            left: 0;
            top: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .nav-item {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);
            border-radius: 2px;
        }
        
        .logo-glow {
            transition: all 0.3s ease;
        }
        
        .logo-glow:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body style="background-color: #d5cbbf;">

    <!-- Login/Register Area -->
    <div id="auth-area" class="min-h-screen gradient-primary flex items-center justify-center p-6">
        <div class="glass-effect rounded-3xl shadow-2xl p-10 max-w-md w-full fade-in">
            <div class="text-center mb-10">
                <img src="https://i.ibb.co/232k2VPP/1755648281347.png" alt="Viva Sabor" class="w-32 h-32 object-contain mx-auto mb-0 logo-glow" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <span class="text-white font-bold text-2xl hidden gradient-accent w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-6">VS</span>
                <h1 class="text-4xl font-bold mb-3" style="color: #33160e;">Viva Sabor</h1>
                <p class="text-gray-700 font-medium">Nutrição que acolhe, sabor que conforta</p>
            </div>
            
            <!-- Login Form -->
            <div id="login-form">
                <form onsubmit="handleLogin(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <input type="email" id="login-email" required 
                                   class="w-full p-4 border-gradient rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300 bg-white/80">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                            <input type="password" id="login-password" required 
                                   class="w-full p-4 border-gradient rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300 bg-white/80">
                        </div>
                        <button type="submit" class="w-full btn-primary py-4 rounded-xl font-bold text-lg shadow-lg">
                            Entrar
                        </button>
                    </div>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-gray-600">Não tem conta? 
                        <button onclick="showCreateAccount()" class="font-semibold hover:underline" style="color: #608041;">
                            Criar conta
                        </button>
                    </p>
                </div>
            </div>
            
            <!-- Create Account Step 1 -->
            <div id="create-account-step1" class="hidden">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Criar Conta - Passo 1</h2>
                    <p class="text-gray-600">Dados básicos da conta</p>
                </div>
                
                <form onsubmit="handleCreateAccountStep1(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                            <input type="text" id="register-name" required 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <input type="email" id="register-email" required 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                            <input type="tel" id="register-phone" required placeholder="(00) 00000-0000" oninput="formatPhone(this)"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                            <input type="password" id="register-password" required minlength="6"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #608041;">
                            Próximo Passo
                        </button>
                    </div>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="showLogin()" class="text-gray-600 hover:underline">
                        Voltar ao login
                    </button>
                </div>
            </div>
            
            <!-- Create Account Step 2 -->
            <div id="create-account-step2" class="hidden">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Criar Conta - Passo 2</h2>
                    <p class="text-gray-600">Informações pessoais</p>
                </div>
                
                <form onsubmit="handleCreateAccountStep2(event)">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Idade</label>
                                <input type="number" id="register-age" required min="18" max="120"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sexo</label>
                                <select id="register-gender" required 
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="">Selecione</option>
                                    <option value="masculino">Masculino</option>
                                    <option value="feminino">Feminino</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Peso (kg)</label>
                                <input type="number" id="register-weight" required min="30" max="300" step="0.1"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Altura (cm)</label>
                                <input type="number" id="register-height" required min="100" max="250"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Restrições Alimentares</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="gluten">
                                    <span class="text-sm text-gray-700">Sem Glúten</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="lactose">
                                    <span class="text-sm text-gray-700">Sem Lactose</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="diabetes">
                                    <span class="text-sm text-gray-700">Diabético</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="vegetarian">
                                    <span class="text-sm text-gray-700">Vegetariano</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="vegan">
                                    <span class="text-sm text-gray-700">Vegano</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="low-carb">
                                    <span class="text-sm text-gray-700">Low Carb</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="keto">
                                    <span class="text-sm text-gray-700">Cetogênica</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="hypertension">
                                    <span class="text-sm text-gray-700">Hipertensão</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="nuts">
                                    <span class="text-sm text-gray-700">Sem Oleaginosas</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" class="checkbox-custom" name="register-restrictions" value="seafood">
                                    <span class="text-sm text-gray-700">Sem Frutos do Mar</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Escolha seu Plano</h3>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                    <input type="radio" name="register-plan" value="Básico" checked class="w-4 h-4 text-green-600">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center">
                                            <span class="font-semibold text-gray-800">Plano Básico</span>
                                            <span class="text-green-600 font-bold">R$ 89,90</span>
                                        </div>
                                        <p class="text-sm text-gray-600"></p>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                    <input type="radio" name="register-plan" value="Premium" class="w-4 h-4 text-green-600">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center">
                                            <span class="font-semibold text-gray-800">Plano Premium</span>
                                            <span class="text-green-600 font-bold">R$ 224,90</span>
                                        </div>
                                        <p class="text-sm text-gray-600"></p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button type="button" onclick="backToStep1()" class="flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                                Voltar
                            </button>
                            <button type="submit" class="flex-1 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #608041;">
                                Criar Conta
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden min-h-screen" style="background-color: #d5cbbf;">
        <!-- Header -->
        <header class="glass-effect shadow-2xl border-b border-white/20">
            <div class="px-8 py-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <img src="https://i.ibb.co/232k2VPP/1755648281347.png" alt="Viva Sabor" class="w-14 h-14 object-contain logo-glow" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <span class="text-white font-bold text-lg hidden gradient-accent w-14 h-14 rounded-2xl flex items-center justify-center">VS</span>
                        <div>
                            <h1 class="text-2xl font-bold" style="color: #33160e;">Viva Sabor</h1>
                            <p id="user-greeting" class="text-sm text-gray-600 font-medium"></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="user-plan" class="px-4 py-2 rounded-full text-sm font-bold text-white gradient-secondary shadow-lg floating"></span>
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="w-12 h-12 rounded-full flex items-center justify-center hover:bg-white/20 transition-all duration-300 glass-effect border border-white/30">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </button>
                            
                            <!-- User Menu Dropdown -->
                            <div id="user-menu" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border z-50">
                                <div class="p-4 border-b">
                                    <p class="font-semibold text-gray-800" id="menu-user-name"></p>
                                    <p class="text-sm text-gray-600" id="menu-user-email"></p>
                                </div>
                                <div class="py-2">
                                    <button onclick="showProfileDetails()" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-700">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        Detalhes do Perfil
                                    </button>
                                    <button onclick="showSupport()" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-700">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Suporte
                                    </button>
                                    <button onclick="showSettings()" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-700">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        Configurações
                                    </button>
                                    <hr class="my-2">
                                    <button onclick="logout()" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Sair da Conta
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="pb-20">
            <!-- Início Section -->
            <div id="section-inicio" class="p-6">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Progresso do Dia</h2>
                    
                    <!-- Progress Cards -->
                    <div class="grid md:grid-cols-3 gap-8 mb-10">
                        <div class="card-elegant rounded-2xl p-8 slide-up">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gradient">Refeições</h3>
                                <span class="text-3xl">🍽️</span>
                            </div>
                            <div class="text-4xl font-bold text-gray-800 mb-3 meals-count">0/6</div>
                            <p class="text-gray-600 font-medium mb-4">Refeições realizadas hoje</p>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div class="progress-meals h-3 rounded-full gradient-primary transition-all duration-1000 ease-out" style="width: 0%;"></div>
                            </div>
                            <div class="mt-4 flex space-x-2">
                                </button>
                                <button onclick="markMealConsumed()" class="text-xs bg-green-500 text-white px-3 py-1 rounded-full hover:bg-green-600 transition-colors">
                                    Refeição ✅
                                </button>
                            </div>
                        </div>
                        
                        <div class="card-elegant rounded-2xl p-8 slide-up" style="animation-delay: 0.2s;">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gradient">Água</h3>
                                <span class="text-3xl floating" style="animation-delay: 1s;">💧</span>
                            </div>
                            <div class="text-4xl font-bold text-gray-800 mb-3 water-count">0.0L</div>
                            <p class="text-gray-600 font-medium mb-4">Meta: 2L por dia</p>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div class="progress-water h-3 rounded-full gradient-primary transition-all duration-1000 ease-out" style="width: 0%;"></div>
                            </div>
                            <div class="mt-4 flex space-x-2">
                                <button onclick="addWaterIntake(200)" class="text-xs bg-blue-400 text-white px-2 py-1 rounded-full hover:bg-blue-500 transition-colors">
                                    +200ml
                                </button>
                                <button onclick="addWaterIntake(500)" class="text-xs bg-blue-600 text-white px-2 py-1 rounded-full hover:bg-blue-700 transition-colors">
                                    +500ml
                                </button>
                            </div>
                        </div>
                        
                        <div class="card-elegant rounded-2xl p-8 slide-up" style="animation-delay: 0.4s;">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gradient">Calorias</h3>
                                <span class="text-3xl floating" style="animation-delay: 2s;">🔥</span>
                            </div>
                            <div class="text-4xl font-bold text-gray-800 mb-3 calories-count">0</div>
                            <p class="text-gray-600 font-medium mb-4">Meta: 1,800 kcal</p>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div class="progress-calories h-3 rounded-full gradient-primary transition-all duration-1000 ease-out" style="width: 0%;"></div>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">Atualizado automaticamente com as refeições</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Prévia das Refeições -->
                    <div class="card-elegant rounded-2xl p-8 mb-10 bounce-in">
                        <h3 class="text-2xl font-bold text-gradient mb-6">Prévia das Refeições do Dia</h3>
                        <div class="grid md:grid-cols-3 gap-6" id="meals-preview">
                            <!-- Meals preview will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Ações Rápidas -->
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Ações Rápidas</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="showSection('receitas')" class="flex flex-col items-center p-6 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mb-3" style="background-color: #dcfce7;">
                                    <span class="text-3xl">🍳</span>
                                </div>
                                <span class="text-base font-medium text-gray-700">Ver Receitas</span>
                            </button>
                            <button onclick="showSection('nutribox')" class="flex flex-col items-center p-6 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mb-3" style="background-color: #fef3c7;">
                                    <span class="text-3xl">📦</span>
                                </div>
                                <span class="text-base font-medium text-gray-700">Pedir NutriBox</span>
                            </button>
                            <button onclick="showSection('consultas')" class="flex flex-col items-center p-6 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mb-3" style="background-color: #dbeafe;">
                                    <span class="text-3xl">👩‍⚕️</span>
                                </div>
                                <span class="text-base font-medium text-gray-700">Consultas</span>
                            </button>
                            <button onclick="showSection('video-aulas')" class="flex flex-col items-center p-6 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mb-3" style="background-color: #fce7f3;">
                                    <span class="text-3xl">🎥</span>
                                </div>
                                <span class="text-base font-medium text-gray-700">Vídeo-aulas</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dica do Dia -->
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">💡 Dica do Dia</h3>
                        <p class="text-gray-700" id="daily-tip">Beba água regularmente ao longo do dia. A hidratação adequada é fundamental para o bom funcionamento do organismo e pode ajudar no controle do apetite.</p>
                    </div>
                </div>
            </div>
            
            <!-- Receitas Section -->
            <div id="section-receitas" class="hidden p-6">
                <div class="max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Receitas Personalizadas</h2>
                        <button onclick="generateNewRecipes()" class="btn-primary px-8 py-3 rounded-xl font-bold shadow-lg">
                            ✨ Gerar Receitas
                        </button>
                    </div>
                    
                    <!-- Recipe Filters -->
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Filtrar por Tipo de Refeição</h3>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterRecipes('all')" class="px-4 py-2 rounded-full text-sm font-medium bg-green-600 text-white">
                                Todas
                            </button>
                            <button onclick="filterRecipes('cafe-da-manha')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Café da Manhã
                            </button>
                            <button onclick="filterRecipes('lanche-manha')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Lanche da Manhã
                            </button>
                            <button onclick="filterRecipes('almoco')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Almoço
                            </button>
                            <button onclick="filterRecipes('lanche-tarde')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Lanche da Tarde
                            </button>
                            <button onclick="filterRecipes('janta')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Jantar
                            </button>
                            <button onclick="filterRecipes('ceia')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">
                                Ceia
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recipes Grid -->
                    <div id="recipes-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Recipes will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- NutriBox Section -->
            <div id="section-nutribox" class="hidden p-6">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Peça sua NutriBox</h2>
                    <div class="bg-white rounded-xl shadow-md p-8">
                        <p class="text-gray-600 mb-6">Receba ingredientes frescos e selecionados diretamente na sua casa!</p>
                        
                        <!-- Order Confirmation Section -->
                        <div id="order-confirmation" class="hidden">
                            <div class="text-center mb-8">
                                <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 gradient-primary">
                                    <span class="text-3xl">✅</span>
                                </div>
                                <h3 class="text-2xl font-bold text-gradient mb-2">Pedido Realizado com Sucesso!</h3>
                                <p class="text-gray-600">Seu pedido foi confirmado e está sendo processado</p>
                            </div>
                            
                            <div class="card-elegant rounded-2xl p-6 mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4">📦 Informações de Entrega</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Tempo estimado:</span>
                                        <span id="delivery-time" class="font-bold text-green-600"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Status:</span>
                                        <span class="font-bold text-blue-600">Preparando pedido</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Número do pedido:</span>
                                        <span id="order-number" class="font-bold text-gray-800"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <button onclick="resetNutriBoxForm()" class="btn-primary px-8 py-3 rounded-xl font-bold shadow-lg">
                                    Fazer Novo Pedido
                                </button>
                            </div>
                        </div>
                        
                        <form id="nutribox-form" onsubmit="handleNutriBoxOrder(event)">
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Selecione as Refeições Desejadas</h3>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="cafe-da-manha" checked class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Café da Manhã</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="lanche-manha" class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Lanche da Manhã</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="almoco" checked class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Almoço</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="lanche-tarde" class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Lanche da Tarde</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="janta" checked class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Jantar</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-colors">
                                        <input type="checkbox" name="nutribox-meals" value="ceia" class="checkbox-custom">
                                        <div>
                                            <span class="font-medium text-gray-800">Ceia</span>
                                            <p class="text-sm text-gray-600">7 receitas semanais</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                                    <input type="text" id="nutribox-name" required 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
                                    <input type="text" id="nutribox-cpf" required placeholder="000.000.000-00" maxlength="14" oninput="formatCPF(this)"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                    <input type="tel" id="nutribox-phone" required placeholder="(00) 00000-0000" oninput="formatPhone(this)"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">CEP</label>
                                    <input type="text" id="nutribox-cep" required placeholder="00.000-000" maxlength="10" onblur="calculateShipping()" oninput="formatCEP(this)"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Endereço + Complemento</label>
                                    <input type="text" id="nutribox-address" required 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Método de Pagamento</label>
                                    <select id="nutribox-payment" required 
                                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <option value="">Selecione</option>
                                        <option value="pix">PIX</option>
                                        <option value="debit">Cartão de Débito</option>
                                        <option value="credit">Cartão de Crédito</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mt-8 bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Resumo do Pedido</h3>
                                <div class="flex justify-between items-center mb-2">
                                    <span>NutriBox Semanal</span>
                                    <span>R$ 224,90</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span>Frete</span>
                                    <span id="shipping-cost">R$ 0,00</span>
                                </div>
                                <div id="premium-discount" class="hidden flex justify-between items-center mb-2 text-green-600">
                                    <span>Desconto Premium</span>
                                    <span>-R$ 10,00</span>
                                </div>
                                <hr class="my-3">
                                <div class="flex justify-between items-center font-bold text-lg">
                                    <span>Total</span>
                                    <span id="total-cost">R$ 224,90</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full mt-6 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);">
                                Finalizar Pedido
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Consultas Section -->
            <div id="section-consultas" class="hidden p-6">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Consultas</h2>
                    
                    <div id="premium-only-message" class="hidden bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center mb-8">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background-color: #fef3c7;">
                            <span class="text-2xl">⭐</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Recurso Premium</h3>
                        <p class="text-gray-600">O agendamento de consultas está disponível apenas para usuários Premium.</p>
                    </div>
                    
                    <div id="appointments-section">
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl shadow-md p-6 text-center">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background-color: #dbeafe;">
                                    <span class="text-2xl">👩‍⚕️</span>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Nutricionista</h3>
                                <p class="text-gray-600 text-sm mb-4">Orientação nutricional personalizada</p>
                                <button onclick="scheduleAppointment('Nutricionista')" class="w-full text-white py-2 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);">
                                    Agendar
                                </button>
                            </div>
                            
                            <div class="bg-white rounded-xl shadow-md p-6 text-center">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background-color: #fef3c7;">
                                    <span class="text-2xl">🧠</span>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Psicólogo</h3>
                                <p class="text-gray-600 text-sm mb-4">Apoio emocional especializado</p>
                                <button onclick="scheduleAppointment('Psicólogo')" class="w-full text-white py-2 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);">
                                    Agendar
                                </button>
                            </div>
                            
                            <div class="bg-white rounded-xl shadow-md p-6 text-center">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background-color: #fce7f3;">
                                    <span class="text-2xl">🏃‍♀️</span>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Terapeuta</h3>
                                <p class="text-gray-600 text-sm mb-4">Terapia especializada</p>
                                <button onclick="scheduleAppointment('Terapeuta')" class="w-full text-white py-2 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background: linear-gradient(135deg, #608041 0%, #cb8b32 100%);">
                                    Agendar
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Consultas Agendadas</h3>
                            <div id="scheduled-appointments">
                                <!-- Appointments will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vídeo-aulas Section -->
            <div id="section-video-aulas" class="hidden p-6">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Vídeo-aulas</h2>
                    
                    <div id="videos-premium-message" class="hidden bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center mb-8">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background-color: #fef3c7;">
                            <span class="text-2xl">🎥</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Conteúdo Premium</h3>
                        <p class="text-gray-600">As vídeo-aulas estão disponíveis apenas para usuários Premium.</p>
                    </div>
                    
                    <div id="videos-section" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Videos will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 glass-effect border-t border-white/20 z-40 backdrop-blur-lg">
            <div class="flex justify-around items-center py-3">
                <button onclick="showSection('inicio')" id="nav-inicio" class="nav-item active flex flex-col items-center py-3 px-4 text-green-600 transition-all duration-300">
                    <svg class="w-7 h-7 mb-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span class="text-xs font-bold">Início</span>
                </button>
                <button onclick="showSection('receitas')" id="nav-receitas" class="nav-item flex flex-col items-center py-3 px-4 text-gray-400 hover:text-green-600 transition-all duration-300">
                    <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span class="text-xs font-bold">Receitas</span>
                </button>
                <button onclick="showSection('nutribox')" id="nav-nutribox" class="nav-item flex flex-col items-center py-3 px-4 text-gray-400 hover:text-green-600 transition-all duration-300">
                    <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    <span class="text-xs font-bold">NutriBox</span>
                </button>
                <button onclick="showSection('consultas')" id="nav-consultas" class="nav-item flex flex-col items-center py-3 px-4 text-gray-400 hover:text-green-600 transition-all duration-300">
                    <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span class="text-xs font-bold">Consultas</span>
                </button>
                <button onclick="showSection('video-aulas')" id="nav-video-aulas" class="nav-item flex flex-col items-center py-3 px-4 text-gray-400 hover:text-green-600 transition-all duration-300">
                    <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-xs font-bold">Vídeo-aulas</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Modals -->
    
    <!-- Appointment Modal -->
    <div id="appointment-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <h2 id="appointment-modal-title" class="text-3xl font-bold text-gray-800 mb-2">Agendar Consulta</h2>
                <p class="text-gray-600">Escolha a data e horário</p>
            </div>
            
            <form id="appointment-form" onsubmit="handleAppointmentSubmit(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data da Consulta</label>
                        <input type="date" id="appointment-date" required 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Horário</label>
                        <select id="appointment-time" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="">Selecione um horário</option>
                            <option value="08:00">08:00</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                        </select>
                    </div>
                    <div class="flex space-x-4">
                        <button type="button" onclick="closeAppointmentModal()" class="flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                            Agendar
                        </button>
                    </div>
                </div>
            </form>
            
            <button onclick="closeAppointmentModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Configurações</h2>
            </div>
            
            <!-- Settings Tabs -->
            <div class="flex space-x-4 mb-8 border-b">
                <button onclick="showSettingsTab('profile')" id="settings-tab-profile" class="py-2 px-4 border-b-2 border-green-500 font-semibold" style="color: #5f723f;">
                    Editar Perfil
                </button>
                <button onclick="showSettingsTab('restrictions')" id="settings-tab-restrictions" class="py-2 px-4 border-b-2 border-transparent text-gray-600 hover:text-green-700 font-semibold">
                    Restrições Alimentares
                </button>
            </div>
            
            <!-- Edit Profile Tab -->
            <div id="settings-profile-tab">
                <form id="edit-profile-form" onsubmit="handleEditProfile(event)">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                            <input type="text" id="edit-name" required 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Idade</label>
                            <input type="number" id="edit-age" required min="18" max="120"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sexo</label>
                            <select id="edit-gender" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Peso (kg)</label>
                            <input type="number" id="edit-weight" required min="30" max="300" step="0.1"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Altura (cm)</label>
                            <input type="number" id="edit-height" required min="100" max="250"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                            Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Restrictions Tab -->
            <div id="settings-restrictions-tab" class="hidden">
                <form id="edit-restrictions-form" onsubmit="handleEditRestrictions(event)">
                    <div class="grid md:grid-cols-2 gap-4">
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="gluten">
                            <span class="text-gray-700">Sem Glúten</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="lactose">
                            <span class="text-gray-700">Sem Lactose</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="diabetes">
                            <span class="text-gray-700">Diabético</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="vegetarian">
                            <span class="text-gray-700">Vegetariano</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="vegan">
                            <span class="text-gray-700">Vegano</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="low-carb">
                            <span class="text-gray-700">Low Carb</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="keto">
                            <span class="text-gray-700">Cetogênica</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="hypertension">
                            <span class="text-gray-700">Hipertensão</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="nuts">
                            <span class="text-gray-700">Sem Oleaginosas</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="checkbox-custom" name="edit-restrictions" value="seafood">
                            <span class="text-gray-700">Sem Frutos do Mar</span>
                        </label>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                            Salvar Restrições
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="mt-8 text-center">
                <button onclick="closeSettingsModal()" class="border-2 border-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                    Fechar
                </button>
            </div>
            
            <button onclick="closeSettingsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = JSON.parse(localStorage.getItem('vivasabor_current_user') || 'null');
        let users = JSON.parse(localStorage.getItem('vivasabor_users') || '{}');
        let appointments = JSON.parse(localStorage.getItem('vivasabor_appointments') || '{}');
        let tempUserData = {};
        let currentAppointmentType = '';

        // Recipe database with weekly rotation
        const recipeWeeks = {
            week1: {
                'cafe-da-manha': [
                    { 
                        name: "Omelete Proteica com Espinafre e Queijo", 
                        calories: 385, 
                        ingredients: ["3 ovos orgânicos inteiros", "2 claras de ovo", "1 xícara de espinafre fresco", "50g de queijo cottage", "30g de queijo mussarela light", "1 colher de sopa de azeite extra virgem", "1 tomate cereja cortado", "Sal rosa e pimenta do reino", "Orégano fresco"], 
                        instructions: "1. Lave bem o espinafre e seque com papel toalha. 2. Separe os ovos, colocando as claras em uma tigela e os ovos inteiros em outra. 3. Bata vigorosamente os ovos inteiros com as claras por 2 minutos até formar espuma leve. 4. Tempere com uma pitada de sal rosa e pimenta do reino moída na hora. 5. Aqueça uma frigideira antiaderente de 24cm em fogo médio e adicione o azeite extra virgem. 6. Quando o azeite estiver morno, adicione o espinafre e refogue por 1 minuto até murchar completamente. 7. Despeje os ovos batidos uniformemente sobre o espinafre, sem mexer. 8. Deixe cozinhar por 2-3 minutos até as bordas começarem a firmar. 9. Com uma espátula, levante delicadamente uma lateral para verificar se está dourada. 10. Distribua o cottage e a mussarela em metade da omelete. 11. Com cuidado, dobre a omelete ao meio usando uma espátula larga. 12. Desligue o fogo e deixe descansar por 1 minuto para o queijo derreter. 13. Transfira para o prato, decore com tomate cereja cortado ao meio e orégano fresco." 
                    },
                    { 
                        name: "Bowl Proteico de Iogurte Grego", 
                        calories: 420, 
                        ingredients: ["200g de iogurte grego natural", "30g de whey protein vanilla", "2 colheres de sopa de granola sem açúcar", "1 colher de sopa de pasta de amendoim integral", "1/2 banana fatiada", "1 colher de sopa de sementes de chia", "5 amêndoas picadas", "Canela em pó"], 
                        instructions: "1. Retire o iogurte grego da geladeira 15 minutos antes para não ficar muito gelado. 2. Em uma tigela média, coloque o iogurte grego e o whey protein. 3. Com um fouet ou garfo, misture vigorosamente por 2 minutos até obter uma textura completamente homogênea e cremosa, sem grumos. 4. Adicione a pasta de amendoim em pequenas porções e misture levemente com movimentos circulares para criar um belo efeito marmorizado. 5. Corte a banana em fatias de 0,5cm de espessura, em formato diagonal para maior elegância. 6. Pique grosseiramente as amêndoas com uma faca bem afiada. 7. Em uma tigela de vidro ou cerâmica bonita, despeje a mistura de iogurte. 8. Disponha as fatias de banana em formato de leque em um lado do bowl. 9. Polvilhe a granola do lado oposto, criando contraste visual. 10. Espalhe as sementes de chia uniformemente por toda superfície. 11. Finalize com as amêndoas picadas no centro e uma generosa pitada de canela em pó. 12. Sirva imediatamente com uma colher de sobremesa dourada ou de madeira para experiência completa." 
                    },
                    { 
                        name: "Panqueca de Aveia com Frutas Vermelhas", 
                        calories: 350, 
                        ingredients: ["1/2 xícara de aveia em flocos", "2 ovos inteiros", "1 banana pequena madura", "1/4 xícara de leite de amêndoas", "1 colher de chá de fermento em pó", "1/2 xícara de mix de frutas vermelhas", "1 colher de sopa de mel", "Canela em pó", "Essência de baunilha"], 
                        instructions: "1. No liquidificador, bata a aveia até virar farinha fina. 2. Adicione os ovos, banana, leite de amêndoas, fermento e uma pitada de canela. 3. Bata por 1 minuto até formar uma massa lisa e homogênea. 4. Deixe descansar por 5 minutos para hidratar a aveia. 5. Aqueça uma frigideira antiaderente pequena em fogo baixo. 6. Despeje 1/3 da massa formando um círculo perfeito. 7. Cozinhe por 3 minutos até formar bolhinhas na superfície. 8. Vire com cuidado e cozinhe por mais 2 minutos. 9. Repita o processo com o restante da massa. 10. Empilhe as panquecas no prato, intercalando com frutas vermelhas. 11. Regue com mel morno e polvilhe canela. Rica em fibras e antioxidantes naturais." 
                    }
                ],
                'lanche-manha': [
                    { 
                        name: "Smoothie Verde Detox", 
                        calories: 180, 
                        ingredients: ["1 xícara de espinafre baby", "1/2 abacate maduro", "1 maçã verde sem casca", "1 colher de sopa de gengibre fresco ralado", "1 xícara de água de coco", "Suco de 1/2 limão", "1 colher de chá de mel", "Gelo a gosto"], 
                        instructions: "Lave bem o espinafre e corte a maçã em pedaços. No liquidificador, adicione primeiro a água de coco, depois o espinafre, abacate, maçã e gengibre. Bata por 1 minuto até ficar cremoso. Adicione o suco de limão, mel e gelo, batendo novamente por 30 segundos. Sirva imediatamente em copo alto. Rico em fibras, vitaminas e antioxidantes naturais." 
                    }
                ],
                'almoco': [
                    { 
                        name: "Salmão Grelhado com Quinoa e Legumes", 
                        calories: 520, 
                        ingredients: ["180g de filé de salmão fresco", "3/4 xícara de quinoa tricolor", "1 xícara de brócolis", "1/2 abobrinha média", "1/4 xícara de cenoura baby", "2 colheres de sopa de azeite extra virgem", "2 dentes de alho", "Sal rosa e pimenta do reino", "Ervas finas (tomilho e alecrim)", "Suco de 1/2 limão", "1 colher de chá de gergelim"], 
                        instructions: "1. Lave a quinoa e cozinhe em caldo de legumes por 15 minutos até ficar al dente. 2. Tempere o salmão com sal, pimenta, ervas e metade do azeite, deixe marinar por 15 minutos. 3. Corte os legumes em pedaços uniformes. 4. Grelhe o salmão em frigideira bem quente por 4 minutos de cada lado, mantendo o centro rosado. 5. Refogue o alho no azeite restante, adicione os legumes e cozinhe por 8 minutos mantendo a textura crocante. 6. Sirva o salmão sobre a quinoa, acompanhe com legumes e finalize com suco de limão e gergelim. Excelente fonte de ômega-3 e proteínas completas." 
                    },
                    { 
                        name: "Peito de Frango com Batata Doce Assada", 
                        calories: 485, 
                        ingredients: ["200g de peito de frango", "1 batata doce média", "1 xícara de vagem", "1/2 pimentão vermelho", "2 colheres de sopa de azeite", "1 colher de chá de páprica doce", "Alho e cebola", "Sal rosa", "Alecrim fresco"], 
                        instructions: "1. Tempere o frango com sal, páprica e alecrim, deixe marinar por 20 minutos. 2. Corte a batata doce em cubos e asse no forno a 200°C por 25 minutos. 3. Grelhe o frango por 6 minutos de cada lado. 4. Refogue a vagem e pimentão rapidamente. 5. Monte o prato com o frango fatiado, batata doce e legumes. Rico em proteínas magras e carboidratos complexos." 
                    }
                ],
                'lanche-tarde': [
                    { 
                        name: "Mix de Castanhas e Frutas Secas", 
                        calories: 220, 
                        ingredients: ["2 colheres de sopa de castanha do Brasil", "1 colher de sopa de amêndoas", "1 colher de sopa de nozes", "2 colheres de sopa de uvas passas", "1 colher de sopa de damasco seco picado"], 
                        instructions: "Misture todos os ingredientes em um recipiente. Consuma como lanche energético. Rico em gorduras boas, fibras e antioxidantes. Porção ideal para manter a energia entre as refeições principais." 
                    }
                ],
                'janta': [
                    { 
                        name: "Frango Grelhado com Batata Doce e Salada", 
                        calories: 420, 
                        ingredients: ["180g de peito de frango", "1 batata doce pequena", "2 xícaras de mix de folhas verdes", "1/2 tomate", "1/4 pepino", "2 colheres de sopa de azeite extra virgem", "1 colher de sopa de vinagre balsâmico", "Sal rosa e pimenta", "Ervas provençais", "1 colher de chá de mostarda dijon"], 
                        instructions: "1. Tempere o frango com sal, pimenta e ervas provençais, deixe marinar por 15 minutos. 2. Corte a batata doce em fatias e asse no forno a 180°C por 20 minutos. 3. Grelhe o frango em frigideira antiaderente por 6 minutos de cada lado até dourar bem. 4. Prepare a salada com folhas, tomate e pepino. 5. Faça um molho com azeite, vinagre e mostarda. 6. Sirva o frango fatiado com batata doce assada e salada fresca. Refeição leve, nutritiva e rica em proteínas." 
                    },
                    { 
                        name: "Peixe Assado com Legumes Mediterrâneos", 
                        calories: 380, 
                        ingredients: ["180g de filé de tilápia", "1 abobrinha média", "1/2 berinjela", "1 tomate", "1/2 cebola roxa", "3 colheres de sopa de azeite", "2 dentes de alho", "Orégano e manjericão", "Sal e pimenta", "Suco de limão"], 
                        instructions: "1. Corte todos os legumes em fatias grossas. 2. Tempere o peixe com sal, pimenta, ervas e suco de limão. 3. Em uma assadeira, disponha os legumes temperados com azeite, alho e ervas. 4. Asse por 15 minutos a 200°C. 5. Adicione o peixe por cima e asse por mais 12 minutos. 6. Finalize com azeite e ervas frescas. Prato completo, saudável e saboroso." 
                    }
                ],
                'ceia': [
                    { 
                        name: "Chá de Camomila com Biscoito de Aveia", 
                        calories: 120, 
                        ingredients: ["1 sachê de chá de camomila", "2 biscoitos integrais de aveia", "1 colher de chá de mel"], 
                        instructions: "Prepare o chá de camomila com água quente por 5 minutos. Adoce com mel se desejar. Acompanhe com os biscoitos de aveia. Ideal para relaxar antes de dormir." 
                    }
                ]
            },
            week2: {
                'cafe-da-manha': [
                    { 
                        name: "Açaí Bowl Proteico", 
                        calories: 450, 
                        ingredients: ["1 polpa de açaí (100g)", "1/2 banana congelada", "30g de whey protein açaí", "2 colheres de sopa de granola proteica", "1 colher de sopa de pasta de amendoim", "5 morangos fatiados", "1 colher de sopa de sementes de girassol", "10 amêndoas laminadas"], 
                        instructions: "Bata a polpa de açaí com a banana congelada e whey protein até formar um creme espesso e homogêneo. Despeje em uma tigela e decore com granola proteica, pasta de amendoim, morangos, sementes e amêndoas. Rico em antioxidantes, proteínas e energia natural para o dia." 
                    },
                    { 
                        name: "Tapioca Proteica com Queijo e Ovo", 
                        calories: 380, 
                        ingredients: ["3 colheres de sopa de goma de tapioca", "1 ovo inteiro", "30g de queijo minas frescal", "1 fatia de peito de peru", "1 tomate cereja", "Orégano", "Azeite de oliva"], 
                        instructions: "Hidrate a tapioca em frigideira antiaderente até formar uma massa. Vire e adicione queijo, peru e tomate de um lado. Dobre ao meio. Em outra frigideira, frite o ovo. Sirva a tapioca com o ovo por cima, regue com azeite e orégano. Combinação perfeita de carboidratos e proteínas." 
                    }
                ],
                'lanche-manha': [
                    { 
                        name: "Iogurte com Chia e Frutas", 
                        calories: 195, 
                        ingredients: ["1 pote de iogurte natural desnatado", "1 colher de sopa de sementes de chia", "1/2 manga picada", "1 colher de chá de mel", "Hortelã fresca"], 
                        instructions: "Misture o iogurte com as sementes de chia e deixe descansar por 15 minutos. Adicione a manga e mel. Decore com hortelã. Fonte de probióticos e ômega-3." 
                    }
                ],
                'almoco': [
                    { 
                        name: "Risotto de Quinoa com Cogumelos e Frango", 
                        calories: 520, 
                        ingredients: ["1 xícara de quinoa", "150g de peito de frango em cubos", "200g de cogumelos variados", "1/2 cebola", "2 dentes de alho", "2 xícaras de caldo de frango", "2 colheres de sopa de azeite", "30g de queijo parmesão", "Salsa e tomilho"], 
                        instructions: "Tempere e doure o frango em cubos, reserve. Refogue cebola e alho no azeite. Adicione quinoa e torre por 2 minutos. Acrescente caldo aos poucos, mexendo sempre por 15 minutos. Refogue os cogumelos separadamente. Incorpore frango e cogumelos ao risotto, finalize com queijo e ervas. Prato completo e nutritivo." 
                    },
                    { 
                        name: "Filé de Peixe com Purê de Mandioquinha", 
                        calories: 465, 
                        ingredients: ["180g de filé de pescada", "2 mandioquinhas médias", "1 xícara de espinafre", "2 colheres de sopa de leite desnatado", "2 colheres de sopa de azeite", "Alho, sal e pimenta", "Limão", "Ervas finas"], 
                        instructions: "Cozinhe as mandioquinhas até ficarem macias, amasse com leite e azeite. Tempere o peixe com sal, pimenta e ervas, grelhe por 3 minutos de cada lado. Refogue o espinafre rapidamente. Sirva o peixe sobre o purê acompanhado do espinafre, finalize com limão." 
                    }
                ],
                'lanche-tarde': [
                    { 
                        name: "Vitamina de Abacate", 
                        calories: 240, 
                        ingredients: ["1/2 abacate", "1 copo de leite de amêndoas", "1 colher de sopa de cacau em pó", "1 colher de chá de mel", "Gelo"], 
                        instructions: "Bata todos os ingredientes no liquidificador até ficar cremoso. Sirva gelado. Rico em gorduras boas e antioxidantes." 
                    }
                ],
                'janta': [
                    { 
                        name: "Peixe ao Papillote com Legumes", 
                        calories: 385, 
                        ingredients: ["180g de filé de pescada", "1 abobrinha em fatias", "1 tomate em rodelas", "1/2 pimentão amarelo", "1 cebola pequena", "Ervas frescas (dill e salsa)", "2 colheres de sopa de azeite", "Limão", "Sal rosa e pimenta"], 
                        instructions: "Tempere o peixe com sal, pimenta e ervas. Em papel alumínio, disponha o peixe sobre uma cama de legumes temperados com azeite. Feche bem formando um papillote e asse por 22 minutos a 180°C. Finalize com limão fresco. Método que preserva todos os nutrientes e sabores naturais." 
                    },
                    { 
                        name: "Omelete de Claras com Legumes", 
                        calories: 280, 
                        ingredients: ["4 claras de ovo", "1 ovo inteiro", "1/2 abobrinha ralada", "1/4 pimentão vermelho", "2 colheres de sopa de cottage", "1 colher de sopa de azeite", "Cebolinha", "Sal e pimenta"], 
                        instructions: "Bata as claras com o ovo inteiro, tempere com sal e pimenta. Refogue os legumes rapidamente no azeite. Despeje os ovos na frigideira, adicione legumes e cottage de um lado. Dobre a omelete e finalize com cebolinha. Jantar leve e proteico." 
                    }
                ],
                'ceia': [
                    { 
                        name: "Leite Dourado com Cúrcuma", 
                        calories: 95, 
                        ingredients: ["1 xícara de leite vegetal", "1/2 colher de chá de cúrcuma", "Pitada de pimenta preta", "Canela", "Mel"], 
                        instructions: "Aqueça o leite com cúrcuma e especiarias por 5 minutos. Adoce com mel. Propriedades anti-inflamatórias e relaxantes." 
                    }
                ]
            }
        };

        // Current week selector
        let currentWeek = 'week1';
        
        // Get current recipe database
        function getCurrentRecipeDatabase() {
            return recipeWeeks[currentWeek];
        }

        // Daily tips
        const dailyTips = [
            "Beba água regularmente ao longo do dia. A hidratação adequada é fundamental para o bom funcionamento do organismo.",
            "Mastigue bem os alimentos. Isso facilita a digestão e aumenta a sensação de saciedade.",
            "Inclua fibras em suas refeições. Elas ajudam no funcionamento intestinal e no controle da glicemia.",
            "Faça pequenas refeições ao longo do dia. Isso mantém o metabolismo ativo e evita a fome excessiva.",
            "Consuma frutas e vegetais de cores variadas. Cada cor oferece nutrientes diferentes para o organismo."
        ];

        // Progress tracking system
        let dailyProgress = {
            meals: { current: 0, total: 6, lastUpdate: null },
            water: { current: 0, total: 2000, lastUpdate: null }, // in ml
            calories: { current: 0, total: 1800, lastUpdate: null }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadDailyProgress();
            if (currentUser) {
                showDashboard();
                startProgressUpdates();
            } else {
                showAuthArea();
            }
        });

        // Authentication functions
        function showAuthArea() {
            document.getElementById('auth-area').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('auth-area').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            updateDashboardInfo();
            loadMealsPreview();
            loadDailyTip();
            showSection('inicio');
        }

        function showCreateAccount() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('create-account-step1').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('create-account-step1').classList.add('hidden');
            document.getElementById('create-account-step2').classList.add('hidden');
        }

        function backToStep1() {
            document.getElementById('create-account-step2').classList.add('hidden');
            document.getElementById('create-account-step1').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = users[email];
                localStorage.setItem('vivasabor_current_user', JSON.stringify(currentUser));
                showDashboard();
                showSuccessMessage('Login realizado com sucesso!');
            } else {
                showErrorMessage('E-mail ou senha incorretos!');
            }
        }

        function handleCreateAccountStep1(event) {
            event.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            
            if (users[email]) {
                showErrorMessage('Este e-mail já está cadastrado!');
                return;
            }
            
            tempUserData = { name, email, phone, password };
            
            document.getElementById('create-account-step1').classList.add('hidden');
            document.getElementById('create-account-step2').classList.remove('hidden');
        }

        function handleCreateAccountStep2(event) {
            event.preventDefault();
            
            const age = parseInt(document.getElementById('register-age').value);
            const gender = document.getElementById('register-gender').value;
            const weight = parseFloat(document.getElementById('register-weight').value);
            const height = parseInt(document.getElementById('register-height').value);
            
            const restrictions = Array.from(document.querySelectorAll('input[name="register-restrictions"]:checked'))
                .map(checkbox => checkbox.value);
            
            const selectedPlan = document.querySelector('input[name="register-plan"]:checked').value;
            
            const userData = {
                ...tempUserData,
                age,
                gender,
                weight,
                height,
                restrictions,
                plan: selectedPlan,
                createdAt: new Date().toISOString()
            };
            
            users[userData.email] = userData;
            localStorage.setItem('vivasabor_users', JSON.stringify(users));
            
            currentUser = userData;
            localStorage.setItem('vivasabor_current_user', JSON.stringify(currentUser));
            
            tempUserData = {};
            showDashboard();
            showSuccessMessage('Conta criada com sucesso!');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('vivasabor_current_user');
            showAuthArea();
            showSuccessMessage('Logout realizado com sucesso!');
        }

        // Dashboard functions
        function updateDashboardInfo() {
            if (!currentUser) return;
            
            document.getElementById('user-greeting').textContent = `Olá, ${currentUser.name.split(' ')[0]}!`;
            document.getElementById('user-plan').textContent = `Plano ${currentUser.plan}`;
            document.getElementById('menu-user-name').textContent = currentUser.name;
            document.getElementById('menu-user-email').textContent = currentUser.email;
            
            // Auto-fill NutriBox form
            document.getElementById('nutribox-name').value = currentUser.name;
            document.getElementById('nutribox-phone').value = currentUser.phone;
            
            // Show/hide premium features
            if (currentUser.plan === 'Premium') {
                document.getElementById('premium-discount').classList.remove('hidden');
                document.getElementById('premium-only-message').classList.add('hidden');
                document.getElementById('videos-premium-message').classList.add('hidden');
                document.getElementById('appointments-section').classList.remove('hidden');
                document.getElementById('videos-section').classList.remove('hidden');
            } else {
                document.getElementById('premium-discount').classList.add('hidden');
                document.getElementById('premium-only-message').classList.remove('hidden');
                document.getElementById('videos-premium-message').classList.remove('hidden');
                document.getElementById('appointments-section').classList.add('hidden');
                document.getElementById('videos-section').classList.add('hidden');
            }
        }

        function showSection(section) {
            // Hide all sections
            const sections = ['inicio', 'receitas', 'nutribox', 'consultas', 'video-aulas'];
            sections.forEach(s => {
                document.getElementById(`section-${s}`).classList.add('hidden');
                const navBtn = document.getElementById(`nav-${s}`);
                if (navBtn) {
                    navBtn.classList.remove('text-green-600', 'active');
                    navBtn.classList.add('text-gray-400');
                }
            });
            
            // Show selected section with animation
            const sectionElement = document.getElementById(`section-${section}`);
            sectionElement.classList.remove('hidden');
            sectionElement.classList.add('fade-in');
            
            const activeBtn = document.getElementById(`nav-${section}`);
            if (activeBtn) {
                activeBtn.classList.remove('text-gray-400');
                activeBtn.classList.add('text-green-600', 'active');
            }
            
            // Load section-specific content
            if (section === 'receitas') {
                loadRecipes();
            } else if (section === 'consultas') {
                loadAppointments();
            } else if (section === 'video-aulas') {
                loadVideos();
            }
        }

        // Progress management functions
        function loadDailyProgress() {
            const today = new Date().toDateString();
            const savedProgress = localStorage.getItem(`vivasabor_progress_${today}`);
            
            if (savedProgress) {
                dailyProgress = JSON.parse(savedProgress);
            } else {
                // Reset progress for new day
                dailyProgress = {
                    meals: { current: 0, total: 6, lastUpdate: null },
                    water: { current: 0, total: 2000, lastUpdate: null },
                    calories: { current: 0, total: 1800, lastUpdate: null }
                };
                saveDailyProgress();
            }
        }

        function saveDailyProgress() {
            const today = new Date().toDateString();
            localStorage.setItem(`vivasabor_progress_${today}`, JSON.stringify(dailyProgress));
        }

        function startProgressUpdates() {
            // Update progress every 30 seconds to simulate real-time tracking
            setInterval(updateProgressBars, 30000);
            
            // Simulate meal consumption based on time of day
            simulateRealtimeProgress();
            
            // Update bars immediately
            updateProgressBars();
        }

        function simulateRealtimeProgress() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = hour * 60 + minute; // minutes since midnight
            
            // Meal times in minutes since midnight
            const mealTimes = {
                breakfast: 8 * 60,      // 08:00
                snack1: 10 * 60,        // 10:00
                lunch: 12.5 * 60,       // 12:30
                snack2: 15 * 60,        // 15:00
                dinner: 19 * 60,        // 19:00
                supper: 21 * 60         // 21:00
            };
            
            // Calculate meals consumed based on current time
            let mealsConsumed = 0;
            let caloriesConsumed = 0;
            
            if (currentTime >= mealTimes.breakfast) {
                mealsConsumed++;
                caloriesConsumed += 385; // Breakfast calories
            }
            if (currentTime >= mealTimes.snack1) {
                mealsConsumed++;
                caloriesConsumed += 180; // Morning snack calories
            }
            if (currentTime >= mealTimes.lunch) {
                mealsConsumed++;
                caloriesConsumed += 520; // Lunch calories
            }
            if (currentTime >= mealTimes.snack2) {
                mealsConsumed++;
                caloriesConsumed += 220; // Afternoon snack calories
            }
            if (currentTime >= mealTimes.dinner) {
                mealsConsumed++;
                caloriesConsumed += 420; // Dinner calories
            }
            if (currentTime >= mealTimes.supper) {
                mealsConsumed++;
                caloriesConsumed += 120; // Supper calories
            }
            
            // Water consumption increases throughout the day
            let waterConsumed = 0;
            if (currentTime >= 7 * 60) waterConsumed += 250;  // 07:00 - 250ml
            if (currentTime >= 9 * 60) waterConsumed += 200;  // 09:00 - 200ml
            if (currentTime >= 11 * 60) waterConsumed += 300; // 11:00 - 300ml
            if (currentTime >= 13 * 60) waterConsumed += 250; // 13:00 - 250ml
            if (currentTime >= 15 * 60) waterConsumed += 200; // 15:00 - 200ml
            if (currentTime >= 17 * 60) waterConsumed += 300; // 17:00 - 300ml
            if (currentTime >= 19 * 60) waterConsumed += 250; // 19:00 - 250ml
            if (currentTime >= 21 * 60) waterConsumed += 250; // 21:00 - 250ml
            
            // Update progress
            dailyProgress.meals.current = Math.min(mealsConsumed, dailyProgress.meals.total);
            dailyProgress.water.current = Math.min(waterConsumed, dailyProgress.water.total);
            dailyProgress.calories.current = Math.min(caloriesConsumed, dailyProgress.calories.total);
            
            saveDailyProgress();
        }

        function updateProgressBars() {
            // Update meals progress
            const mealsPercent = (dailyProgress.meals.current / dailyProgress.meals.total) * 100;
            const mealsBar = document.querySelector('.progress-meals');
            if (mealsBar) {
                mealsBar.style.width = `${mealsPercent}%`;
            }
            document.querySelector('.meals-count').textContent = `${dailyProgress.meals.current}/${dailyProgress.meals.total}`;
            
            // Update water progress
            const waterPercent = (dailyProgress.water.current / dailyProgress.water.total) * 100;
            const waterBar = document.querySelector('.progress-water');
            if (waterBar) {
                waterBar.style.width = `${waterPercent}%`;
            }
            document.querySelector('.water-count').textContent = `${(dailyProgress.water.current / 1000).toFixed(1)}L`;
            
            // Update calories progress
            const caloriesPercent = (dailyProgress.calories.current / dailyProgress.calories.total) * 100;
            const caloriesBar = document.querySelector('.progress-calories');
            if (caloriesBar) {
                caloriesBar.style.width = `${caloriesPercent}%`;
            }
            document.querySelector('.calories-count').textContent = dailyProgress.calories.current.toLocaleString();
        }

        function addWaterIntake(amount) {
            dailyProgress.water.current = Math.min(dailyProgress.water.current + amount, dailyProgress.water.total);
            saveDailyProgress();
            updateProgressBars();
            showSuccessMessage(`+${amount}ml de água adicionado!`);
        }

        function markMealConsumed() {
            if (dailyProgress.meals.current < dailyProgress.meals.total) {
                dailyProgress.meals.current++;
                saveDailyProgress();
                updateProgressBars();
                showSuccessMessage('Refeição marcada como consumida!');
            }
        }

        function loadMealsPreview() {
            const container = document.getElementById('meals-preview');
            const now = new Date();
            const hour = now.getHours();
            
            // Determine next meals based on current time
            let meals = [];
            
            if (hour < 8) {
                meals = [
                    { name: 'Café da Manhã', time: '08:00', recipe: 'Omelete Proteica com Espinafre', status: 'próxima' },
                    { name: 'Almoço', time: '12:30', recipe: 'Salmão Grelhado com Quinoa', status: 'pendente' },
                    { name: 'Jantar', time: '19:00', recipe: 'Frango Grelhado com Batata Doce', status: 'pendente' }
                ];
            } else if (hour < 12) {
                meals = [
                    { name: 'Café da Manhã', time: '08:00', recipe: 'Omelete Proteica com Espinafre', status: 'concluída' },
                    { name: 'Almoço', time: '12:30', recipe: 'Salmão Grelhado com Quinoa', status: 'próxima' },
                    { name: 'Jantar', time: '19:00', recipe: 'Frango Grelhado com Batata Doce', status: 'pendente' }
                ];
            } else if (hour < 19) {
                meals = [
                    { name: 'Café da Manhã', time: '08:00', recipe: 'Omelete Proteica com Espinafre', status: 'concluída' },
                    { name: 'Almoço', time: '12:30', recipe: 'Salmão Grelhado com Quinoa', status: 'concluída' },
                    { name: 'Jantar', time: '19:00', recipe: 'Frango Grelhado com Batata Doce', status: 'próxima' }
                ];
            } else {
                meals = [
                    { name: 'Café da Manhã', time: '08:00', recipe: 'Omelete Proteica com Espinafre', status: 'concluída' },
                    { name: 'Almoço', time: '12:30', recipe: 'Salmão Grelhado com Quinoa', status: 'concluída' },
                    { name: 'Jantar', time: '19:00', recipe: 'Frango Grelhado com Batata Doce', status: 'concluída' }
                ];
            }
            
            container.innerHTML = meals.map(meal => {
                let statusClass = '';
                let statusIcon = '';
                
                switch(meal.status) {
                    case 'concluída':
                        statusClass = 'bg-green-50 border-green-200';
                        statusIcon = '✅';
                        break;
                    case 'próxima':
                        statusClass = 'bg-blue-50 border-blue-200';
                        statusIcon = '⏰';
                        break;
                    default:
                        statusClass = 'bg-gray-50 border-gray-200';
                        statusIcon = '⏳';
                }
                
                return `
                    <div class="${statusClass} border rounded-lg p-4 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">${meal.name}</h4>
                                <p class="text-sm text-gray-600">${meal.time}</p>
                            </div>
                            <span class="text-lg">${statusIcon}</span>
                        </div>
                        <p class="text-sm text-gray-700">${meal.recipe}</p>
                        ${meal.status === 'próxima' ? `
                            <button onclick="markMealConsumed()" class="mt-2 text-xs bg-green-600 text-white px-3 py-1 rounded-full hover:bg-green-700 transition-colors">
                                Marcar como consumida
                            </button>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function loadDailyTip() {
            const tipElement = document.getElementById('daily-tip');
            const randomTip = dailyTips[Math.floor(Math.random() * dailyTips.length)];
            tipElement.textContent = randomTip;
        }

        function loadRecipes() {
            const container = document.getElementById('recipes-grid');
            const allRecipes = [];
            const recipeDatabase = getCurrentRecipeDatabase();
            
            Object.keys(recipeDatabase).forEach(mealType => {
                recipeDatabase[mealType].forEach(recipe => {
                    allRecipes.push({ ...recipe, type: mealType });
                });
            });
            
            container.innerHTML = allRecipes.map((recipe, index) => `
                <div class="recipe-card card-elegant rounded-2xl p-6 fade-in" style="animation-delay: ${index * 0.1}s;">
                    <div class="flex justify-between items-start mb-6">
                        <h3 class="text-xl font-bold text-gradient">${recipe.name}</h3>
                        <span class="px-3 py-1 gradient-secondary text-white text-sm font-bold rounded-full shadow-lg">${recipe.calories} kcal</span>
                    </div>
                    <div class="space-y-3 mb-6">
                        <h4 class="font-bold text-gray-700">Ingredientes:</h4>
                        <ul class="space-y-2">
                            ${recipe.ingredients.slice(0, 3).map(ing => `<li class="ingredient-item text-sm text-gray-600">${ing}</li>`).join('')}
                            ${recipe.ingredients.length > 3 ? `<li class="text-gray-400 text-sm ml-8">... e mais ${recipe.ingredients.length - 3} ingredientes</li>` : ''}
                        </ul>
                    </div>
                    <button onclick="showRecipeDetails('${recipe.name}', '${recipe.instructions}', '${recipe.ingredients.join(', ')}', ${recipe.calories})" class="w-full btn-primary py-3 rounded-xl font-bold shadow-lg">
                        👨‍🍳 Ver Receita Completa
                    </button>
                </div>
            `).join('');
        }

        function generateNewRecipes() {
            // Switch to next week
            currentWeek = currentWeek === 'week1' ? 'week2' : 'week1';
            loadRecipes();
            loadMealsPreview();
            showSuccessMessage(`Receitas da Semana ${currentWeek === 'week1' ? '1' : '2'} carregadas! Novas opções baseadas nas suas restrições.`);
        }

        function filterRecipes(type) {
            // Update filter buttons
            document.querySelectorAll('[onclick^="filterRecipes"]').forEach(btn => {
                btn.className = 'px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300';
            });
            event.target.className = 'px-4 py-2 rounded-full text-sm font-medium bg-green-600 text-white';
            
            const container = document.getElementById('recipes-grid');
            
            if (type === 'all') {
                loadRecipes();
                return;
            }
            
            const recipeDatabase = getCurrentRecipeDatabase();
            const filteredRecipes = recipeDatabase[type] || [];
            
            container.innerHTML = filteredRecipes.map(recipe => `
                <div class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-gray-800">${recipe.name}</h3>
                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">${recipe.calories} kcal</span>
                    </div>
                    <div class="space-y-2 mb-4">
                        <h4 class="font-semibold text-gray-700">Ingredientes:</h4>
                        <ul class="text-sm text-gray-600">
                            ${recipe.ingredients.slice(0, 3).map(ing => `<li>• ${ing}</li>`).join('')}
                            ${recipe.ingredients.length > 3 ? `<li class="text-gray-400">... e mais ${recipe.ingredients.length - 3}</li>` : ''}
                        </ul>
                    </div>
                    <button onclick="showRecipeDetails('${recipe.name}', '${recipe.instructions}', '${recipe.ingredients.join(', ')}', ${recipe.calories})" class="w-full text-white py-2 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #8f864c;">
                        Ver Receita Completa
                    </button>
                </div>
            `).join('');
        }

        function showRecipeDetails(name, instructions, ingredients, calories) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            // Process instructions to create numbered steps
            const processedInstructions = instructions.split(/(?=\d+\.)/).filter(step => step.trim());
            let instructionSteps = [];
            
            if (processedInstructions.length > 1) {
                // Already numbered
                instructionSteps = processedInstructions.map(step => step.trim()).filter(step => step);
            } else {
                // Split by sentence and number them
                const sentences = instructions.split(/(?<=[.!?])\s+/).filter(s => s.trim());
                instructionSteps = sentences.map((sentence, index) => `${index + 1}. ${sentence.trim()}`);
            }
            
            modal.innerHTML = `
                <div class="glass-effect rounded-3xl shadow-2xl p-10 max-w-6xl w-full max-h-screen overflow-y-auto bounce-in">
                    <div class="text-center mb-10">
                        <h2 class="text-4xl font-bold text-gradient mb-4">${name}</h2>
                        <div class="inline-block px-6 py-2 gradient-secondary text-white font-bold rounded-full shadow-lg floating">${calories} kcal</div>
                    </div>
                    
                    <div class="grid lg:grid-cols-2 gap-10">
                        <!-- Ingredientes -->
                        <div class="card-elegant rounded-2xl p-8 slide-up">
                            <div class="flex items-center mb-8">
                                <div class="w-12 h-12 rounded-full gradient-primary flex items-center justify-center mr-4 shadow-lg">
                                    <span class="text-white text-xl">🛒</span>
                                </div>
                                <h3 class="text-2xl font-bold text-gradient">Ingredientes</h3>
                            </div>
                            <div class="space-y-4">
                                ${ingredients.split(', ').map((ingredient, index) => `
                                    <div class="flex items-start space-x-4 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors" style="animation-delay: ${index * 0.1}s;">
                                        <div class="w-6 h-6 rounded-full gradient-accent flex items-center justify-center flex-shrink-0 mt-1">
                                            <span class="text-white text-xs font-bold">${index + 1}</span>
                                        </div>
                                        <span class="text-gray-700 font-medium leading-relaxed">${ingredient.trim()}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Modo de Preparo -->
                        <div class="card-elegant rounded-2xl p-8 slide-up" style="animation-delay: 0.2s;">
                            <div class="flex items-center mb-8">
                                <div class="w-12 h-12 rounded-full gradient-primary flex items-center justify-center mr-4 shadow-lg">
                                    <span class="text-white text-xl">👨‍🍳</span>
                                </div>
                                <h3 class="text-2xl font-bold text-gradient">Modo de Preparo</h3>
                            </div>
                            <div class="space-y-6">
                                ${instructionSteps.map((step, index) => {
                                    const cleanStep = step.replace(/^\d+\.\s*/, '').trim();
                                    return `
                                        <div class="relative pl-16 pb-6 border-l-2 border-gray-200 last:border-l-0" style="animation: slideUp 0.6s ease-out ${index * 0.1}s both;">
                                            <div class="absolute -left-6 top-0 w-12 h-12 rounded-full gradient-secondary flex items-center justify-center shadow-lg">
                                                <span class="text-white font-bold text-lg">${index + 1}</span>
                                            </div>
                                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                                                <p class="text-gray-700 leading-relaxed font-medium">${cleanStep}</p>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dicas Extras -->
                    <div class="mt-10 card-elegant rounded-2xl p-8 slide-up" style="animation-delay: 0.4s;">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 rounded-full gradient-accent flex items-center justify-center mr-4 shadow-lg">
                                <span class="text-white text-lg">💡</span>
                            </div>
                            <h4 class="text-xl font-bold text-gradient">Dicas do Chef</h4>
                        </div>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="bg-gradient-to-br from-green-50 to-blue-50 p-4 rounded-xl">
                                <p class="text-sm text-gray-700"><strong>⏱️ Tempo:</strong> Prepare todos os ingredientes antes de começar para agilizar o processo.</p>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 p-4 rounded-xl">
                                <p class="text-sm text-gray-700"><strong>🔥 Temperatura:</strong> Mantenha o fogo adequado para não queimar os alimentos.</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl">
                                <p class="text-sm text-gray-700"><strong>✨ Apresentação:</strong> Sirva imediatamente para manter sabor e textura ideais.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-10 text-center">
                        <button onclick="this.closest('.fixed').remove()" class="btn-primary px-12 py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-105 transition-transform">
                            ✨ Fechar Receita
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // NutriBox functions
        function calculateShipping() {
            const cep = document.getElementById('nutribox-cep').value;
            const companyCep = '41800-700';
            
            // Simulate shipping calculation
            let shippingCost = 15.00;
            
            if (currentUser && currentUser.plan === 'Premium') {
                shippingCost = 0;
                document.getElementById('shipping-cost').textContent = 'Grátis';
            } else {
                document.getElementById('shipping-cost').textContent = `R$ ${shippingCost.toFixed(2)}`;
            }
            
            updateTotalCost(shippingCost);
        }

        function updateTotalCost(shippingCost) {
            let total = 224.90 + shippingCost;
            
            if (currentUser && currentUser.plan === 'Premium') {
                total -= 10.00; // Premium discount
            }
            
            document.getElementById('total-cost').textContent = `R$ ${total.toFixed(2)}`;
        }

        function handleNutriBoxOrder(event) {
            event.preventDefault();
            
            const selectedMeals = Array.from(document.querySelectorAll('input[name="nutribox-meals"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedMeals.length === 0) {
                showErrorMessage('Selecione pelo menos um tipo de refeição!');
                return;
            }
            
            const cep = document.getElementById('nutribox-cep').value;
            
            // Calculate delivery time based on CEP distance simulation
            const deliveryTime = calculateDeliveryTime(cep);
            
            // Generate order number
            const orderNumber = 'VB' + Date.now().toString().slice(-6);
            
            // Hide form and show confirmation
            document.getElementById('nutribox-form').classList.add('hidden');
            document.getElementById('order-confirmation').classList.remove('hidden');
            
            // Update delivery info
            document.getElementById('delivery-time').textContent = deliveryTime;
            document.getElementById('order-number').textContent = orderNumber;
            
            showSuccessMessage('Pedido confirmado! Verifique os detalhes de entrega abaixo.');
        }
        
        function calculateDeliveryTime(cep) {
            // Remove formatting from CEP
            const cleanCep = cep.replace(/\D/g, '');
            const companyCep = '41800700'; // Company CEP without formatting
            
            if (!cleanCep || cleanCep.length !== 8) {
                return '4-6 horas';
            }
            
            // Calculate "distance" based on CEP difference (simulation)
            const cepDiff = Math.abs(parseInt(cleanCep.substring(0, 5)) - parseInt(companyCep.substring(0, 5)));
            
            let deliveryHours;
            if (cepDiff <= 100) {
                deliveryHours = 1.5; // 1h30min minimum
            } else if (cepDiff <= 500) {
                deliveryHours = 3;
            } else if (cepDiff <= 1000) {
                deliveryHours = 6;
            } else if (cepDiff <= 5000) {
                deliveryHours = 12;
            } else {
                deliveryHours = 24; // 1 day maximum
            }
            
            if (deliveryHours < 2) {
                return '1h30min - 2h';
            } else if (deliveryHours <= 4) {
                return '2-4 horas';
            } else if (deliveryHours <= 8) {
                return '4-8 horas';
            } else if (deliveryHours <= 12) {
                return '8-12 horas';
            } else {
                return '12-24 horas';
            }
        }
        
        function resetNutriBoxForm() {
            // Show form and hide confirmation
            document.getElementById('nutribox-form').classList.remove('hidden');
            document.getElementById('order-confirmation').classList.add('hidden');
            
            // Reset form
            document.getElementById('nutribox-form').reset();
            
            // Restore auto-filled values and default selections
            document.getElementById('nutribox-name').value = currentUser.name;
            document.getElementById('nutribox-phone').value = currentUser.phone;
            document.querySelector('input[name="nutribox-meals"][value="cafe-da-manha"]').checked = true;
            document.querySelector('input[name="nutribox-meals"][value="almoco"]').checked = true;
            document.querySelector('input[name="nutribox-meals"][value="janta"]').checked = true;
            
            // Reset shipping cost
            document.getElementById('shipping-cost').textContent = 'R$ 0,00';
            document.getElementById('total-cost').textContent = 'R$ 224,90';
        }

        // Appointments functions
        function loadAppointments() {
            const container = document.getElementById('scheduled-appointments');
            const userAppointments = appointments[currentUser?.email] || [];
            
            if (userAppointments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">Nenhuma consulta agendada</p>';
                return;
            }
            
            container.innerHTML = userAppointments.map(appointment => `
                <div class="flex justify-between items-center py-3 border-b border-gray-200 last:border-b-0">
                    <div>
                        <h4 class="font-semibold text-gray-800">${appointment.type}</h4>
                        <p class="text-sm text-gray-600">${formatDate(appointment.date)} às ${appointment.time}</p>
                        <span class="inline-block px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">${appointment.status}</span>
                    </div>
                    <button onclick="cancelAppointment('${appointment.id}')" class="text-red-600 hover:text-red-800 text-sm">
                        Cancelar
                    </button>
                </div>
            `).join('');
        }

        function scheduleAppointment(type) {
            if (currentUser.plan !== 'Premium') {
                showErrorMessage('Agendamento de consultas disponível apenas para usuários Premium!');
                return;
            }
            
            currentAppointmentType = type;
            document.getElementById('appointment-modal-title').textContent = `Agendar Consulta - ${type}`;
            document.getElementById('appointment-modal').classList.remove('hidden');
            
            // Set minimum date to today (Brazil timezone)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointment-date').min = today;
        }

        function closeAppointmentModal() {
            document.getElementById('appointment-modal').classList.add('hidden');
            document.getElementById('appointment-form').reset();
        }

        function handleAppointmentSubmit(event) {
            event.preventDefault();
            
            const date = document.getElementById('appointment-date').value;
            const time = document.getElementById('appointment-time').value;
            
            const appointmentData = {
                id: Date.now().toString(),
                type: currentAppointmentType,
                date,
                time,
                status: 'Agendado'
            };
            
            if (!appointments[currentUser.email]) {
                appointments[currentUser.email] = [];
            }
            
            appointments[currentUser.email].push(appointmentData);
            localStorage.setItem('vivasabor_appointments', JSON.stringify(appointments));
            
            closeAppointmentModal();
            loadAppointments();
            showSuccessMessage(`Consulta com ${currentAppointmentType} agendada para ${formatDate(date)} às ${time}!`);
        }

        function cancelAppointment(appointmentId) {
            if (!appointments[currentUser.email]) return;
            
            appointments[currentUser.email] = appointments[currentUser.email].filter(app => app.id !== appointmentId);
            localStorage.setItem('vivasabor_appointments', JSON.stringify(appointments));
            
            loadAppointments();
            showSuccessMessage('Consulta cancelada com sucesso!');
        }

        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Videos functions
        function loadVideos() {
            if (currentUser.plan !== 'Premium') return;
            
            const container = document.getElementById('videos-section');
            const videos = [
                { title: "Salada Nutritiva", duration: "8 min", emoji: "🥗" },
                { title: "Omelete Perfeita", duration: "12 min", emoji: "🍳" },
                { title: "Sopa Caseira", duration: "15 min", emoji: "🍲" },
                { title: "Smoothie Verde", duration: "6 min", emoji: "🥤" },
                { title: "Peixe Grelhado", duration: "18 min", emoji: "🐟" },
                { title: "Quinoa com Legumes", duration: "14 min", emoji: "🌾" }
            ];
            
            container.innerHTML = videos.map(video => `
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center">
                        <span class="text-6xl">${video.emoji}</span>
                    </div>
                    <div class="p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">${video.title}</h3>
                        <p class="text-gray-600 text-sm mb-4">Aprenda o passo a passo completo</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">⏱️ ${video.duration}</span>
                            <button onclick="playVideo('${video.title}')" class="text-white px-4 py-2 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                                Assistir
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function playVideo(title) {
            showSuccessMessage(`Reproduzindo: ${title}`);
        }

        // User menu functions
        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            menu.classList.toggle('hidden');
        }

        function showProfileDetails() {
            document.getElementById('user-menu').classList.add('hidden');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Detalhes do Perfil</h2>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Nome:</span>
                            <span class="text-gray-600">${currentUser.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">E-mail:</span>
                            <span class="text-gray-600">${currentUser.email}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Plano:</span>
                            <span class="text-gray-600">${currentUser.plan}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Idade:</span>
                            <span class="text-gray-600">${currentUser.age} anos</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Peso:</span>
                            <span class="text-gray-600">${currentUser.weight} kg</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Altura:</span>
                            <span class="text-gray-600">${currentUser.height} cm</span>
                        </div>
                    </div>
                    
                    <div class="mt-8 text-center">
                        <button onclick="this.closest('.fixed').remove()" class="text-white px-8 py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSupport() {
            document.getElementById('user-menu').classList.add('hidden');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            let supportContent;
            if (currentUser.plan === 'Premium') {
                supportContent = `
                    <div class="space-y-4">
                        <p class="text-gray-600">Como usuário Premium, você tem acesso ao chat ao vivo com nossa IA especializada!</p>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background-color: #5f723f;">
                                    <span class="text-white text-sm">🤖</span>
                                </div>
                                <span class="font-medium">Assistente IA</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Olá! Como posso ajudá-lo hoje?</p>
                            <div class="flex space-x-2">
                                <input type="text" placeholder="Digite sua mensagem..." class="flex-1 p-2 border border-gray-300 rounded-lg text-sm">
                                <button onclick="sendChatMessage()" class="text-white px-4 py-2 rounded-lg text-sm font-semibold" style="background-color: #5f723f;">
                                    Enviar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                supportContent = `
                    <div class="space-y-4">
                        <p class="text-gray-600">Entre em contato conosco por e-mail:</p>
                        <form onsubmit="sendSupportEmail(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Assunto</label>
                                    <input type="text" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mensagem</label>
                                    <textarea rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                                </div>
                                <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors" style="background-color: #5f723f;">
                                    Enviar E-mail
                                </button>
                            </div>
                        </form>
                    </div>
                `;
            }
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Suporte</h2>
                    </div>
                    
                    ${supportContent}
                    
                    <div class="mt-8 text-center">
                        <button onclick="this.closest('.fixed').remove()" class="border-2 border-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function sendChatMessage() {
            showSuccessMessage('Mensagem enviada! Nossa IA responderá em breve.');
        }

        function sendSupportEmail(event) {
            event.preventDefault();
            showSuccessMessage('E-mail enviado com sucesso! Responderemos em breve.');
            event.target.closest('.fixed').remove();
        }

        function showSettings() {
            document.getElementById('user-menu').classList.add('hidden');
            
            // Load current user data
            document.getElementById('edit-name').value = currentUser.name;
            document.getElementById('edit-age').value = currentUser.age;
            document.getElementById('edit-gender').value = currentUser.gender;
            document.getElementById('edit-weight').value = currentUser.weight;
            document.getElementById('edit-height').value = currentUser.height;
            
            // Load restrictions
            const restrictions = currentUser.restrictions || [];
            document.querySelectorAll('input[name="edit-restrictions"]').forEach(checkbox => {
                checkbox.checked = restrictions.includes(checkbox.value);
            });
            
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettingsModal() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function showSettingsTab(tab) {
            // Hide all tabs
            document.getElementById('settings-profile-tab').classList.add('hidden');
            document.getElementById('settings-restrictions-tab').classList.add('hidden');
            
            // Update tab buttons
            document.getElementById('settings-tab-profile').classList.remove('border-green-500');
            document.getElementById('settings-tab-profile').classList.add('border-transparent', 'text-gray-600');
            document.getElementById('settings-tab-restrictions').classList.remove('border-green-500');
            document.getElementById('settings-tab-restrictions').classList.add('border-transparent', 'text-gray-600');
            
            // Show selected tab
            document.getElementById(`settings-${tab}-tab`).classList.remove('hidden');
            document.getElementById(`settings-tab-${tab}`).classList.add('border-green-500');
            document.getElementById(`settings-tab-${tab}`).classList.remove('border-transparent', 'text-gray-600');
            document.getElementById(`settings-tab-${tab}`).style.color = '#5f723f';
        }

        function handleEditProfile(event) {
            event.preventDefault();
            
            currentUser.name = document.getElementById('edit-name').value;
            currentUser.age = parseInt(document.getElementById('edit-age').value);
            currentUser.gender = document.getElementById('edit-gender').value;
            currentUser.weight = parseFloat(document.getElementById('edit-weight').value);
            currentUser.height = parseInt(document.getElementById('edit-height').value);
            
            // Update in storage
            users[currentUser.email] = currentUser;
            localStorage.setItem('vivasabor_users', JSON.stringify(users));
            localStorage.setItem('vivasabor_current_user', JSON.stringify(currentUser));
            
            updateDashboardInfo();
            showSuccessMessage('Perfil atualizado com sucesso!');
            closeSettingsModal();
        }

        function handleEditRestrictions(event) {
            event.preventDefault();
            
            const restrictions = Array.from(document.querySelectorAll('input[name="edit-restrictions"]:checked'))
                .map(checkbox => checkbox.value);
            
            currentUser.restrictions = restrictions;
            
            // Update in storage
            users[currentUser.email] = currentUser;
            localStorage.setItem('vivasabor_users', JSON.stringify(users));
            localStorage.setItem('vivasabor_current_user', JSON.stringify(currentUser));
            
            showSuccessMessage('Restrições alimentares atualizadas com sucesso!');
            closeSettingsModal();
        }

        // Formatting functions
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        function formatCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                input.value = value;
            }
        }

        function formatCEP(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{2})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        // Utility functions
        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 3000);
        }

        function showErrorMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 3000);
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('user-menu');
            const userButton = event.target.closest('[onclick="toggleUserMenu()"]');
            
            if (userButton || !userMenu) return;
            
            if (!userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971ddb3334e2f622',t:'MTc1NTY1MDYwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
    </html>
